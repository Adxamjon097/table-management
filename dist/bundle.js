!function(e){var t={};function a(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,a),l.l=!0,l.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)a.d(n,l,function(t){return e[t]}.bind(null,l));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t){$(document).ready((function(){let e=$("button#add"),t=$("#content"),a=$("#save"),n=$("#table-view-add-row"),l=$("#table-view-remove-row");var o=$("#update-table-id").length>0?$("#update-table-id").val():null;let p=[],r=[],s=[],i=null,c=null;function u(e){$("div#types").html("");let t=$("<table class='table table-striped'>"),a=$("<tbody>"),n=$("<thead>").appendTo(t),l=$("<tr>").appendTo(n);for(let t=0;t<e.length;t++){let a=$('<td class="text-center">').appendTo(l);$('<a href="#!">').html('<i class="fa fa-close"></i>').appendTo(a).click((function(){e.length>1&&(e.splice(t,1),u(e))})),$('<a href="#!">').html('<i class="fa fa-plus"></i>').appendTo(a).click((function(){e.splice(t+1,0,{type:1,variants:[],name:"",formula:"",table:""}),u(e)}))}let o=$("<tr>");for(let t=0;t<e.length;t++){let a=$("<td>"),n=$('<div class="wrap">'),l=$('<div class="left">'),p=$('<div class="form-group active">'),r=$('<div class="form-group active">'),i=$('<div class="form-group formula '+(4==e[t].type?"active":"")+'">'),c=$('<div class="form-group table '+(5==e[t].type?"active":"")+'">'),u=$("<select class='table-select form-control'>"),f=$('<div class="addInput"></div>'),d=$('<div class="form-group last select '+(2==e[t].type?"active":"")+'"></div>'),m=$('<a href="#!" class="addInput"><i class="fa fa-plus"></i></a>'),v=$("<select class='type-select form-control'>").val(e[t].type).change((function(){e[t].type=$(this).val(),0==s.length&&$.ajax({method:"POST",url:"http://eko.md.uz/api/default/tables"}).done((function(e){s=e,console.log(s);for(let e=0;e<s.length;e++)$opt=$('<option value=" '+s[e]+' " >'+s[e]+" </option>"),$opt.appendTo($(".table-select")),console.log(s[e])}))})),b=$('<option value="1" '+(1==e[t].type?"selected":"")+">number</option>"),h=$('<option value="2" '+(2==e[t].type?"selected":"")+">select</option>"),g=$('<option value="3" '+(3==e[t].type?"selected":"")+">text</option>"),T=$('<option value="4" '+(4==e[t].type?"selected":"")+">formula</option>"),y=$('<option value="5" '+(5==e[t].type?"selected":"")+">table</option>"),x=$('<option value="6" '+(6==e[t].type?"selected":"")+">date</option>"),w=$('<option value="7" '+(7==e[t].type?"selected":"")+">numberation</option>"),N=$("<input type='text' class='form-control' placeholder='name'>").val(e[t].name).change((function(){e[t].name=$(this).val()})),k=$("<input type='text' class='form-control' placeholder='formula'>").val(e[t].formula).change((function(){e[t].formula=$(this).val()}));b.appendTo(v),h.appendTo(v),g.appendTo(v),T.appendTo(v),y.appendTo(v),x.appendTo(v),w.appendTo(v),k.appendTo(i),v.appendTo(p),N.appendTo(r),r.appendTo(l),p.appendTo(l);for(let a=0;e[t].variants&&a<e[t].variants.length;a++){let n=$("<input type='text' name='variant' class='form-control' placeholder='variants'>").val(e[t].variants[a]).change((function(){e[t].variants[$(this).closest("td").find("input[name=variant]").index(this)]=$(this).val(),console.log(e[t].variants)})),o=$('<div class="form-group select item input-group '+(0==a?" first ":"")+(2==e[t].type?"active":"")+'">');n.appendTo(o),$('<span class="input-group-btn"><button class="btn btn-default"><i class="fa fa-minus"></i></button></span>').appendTo(o),o.appendTo(l)}if(!e[t].variants||e[t].variants&&0==e[t].variants.length){e[t].variants||(e[t].variants=[]);let a=$("<input type='text' name='variant' class='form-control' placeholder='variants'>").change((function(){e[t].variants[$(this).closest("td").find("input[name=variant]").index(this)]=$(this).val(),console.log(e[t].variants)})),n=$('<div class="form-group select item input-group first '+(2==e[t].type?"active":"")+'">');a.appendTo(n),$('<span class="input-group-btn"><button class="btn btn-default"><i class="fa fa-minus"></i></button></span>').appendTo(n),n.appendTo(l)}i.appendTo(l),u.appendTo(c),c.appendTo(l),f.appendTo(l),m.appendTo(d),d.appendTo(l),l.appendTo(n),n.appendTo(a),a.appendTo(o)}o.appendTo(a),a.appendTo(t),t.appendTo("div#types")}function f(e,t=!1){!function(e,t=!1){var a=null,n=new Array(e.length).fill(0);for(let t=0;t<e.length;t++)for(let a=0;a<e[t].length;a++)if(n[t]+=Number.parseInt(e[t][a].colspan),Number.parseInt(e[t][a].rowspan)>1)for(let l=t+1;l<=t+Number.parseInt(e[t][a].rowspan)-1;l++)n[l]+=Number.parseInt(e[t][a].colspan);if(t){a=Math.min(...n);for(let t=0;t<n.length;t++)if(console.log(a,n[t]),console.log(e),n[t]>a)for(let l=0;l<n[t]-a;l++)e[t][e[t].length-1]&&(1==e[t][e[t].length-1].colspan?e[t].pop():e[t][e[t].length-1].colspan--)}else{a=Math.max(...n);for(let t=0;t<n.length;t++)if(n[t]!=a)for(let l=0;l<a-n[t];l++)e[t].push({name:"",rowspan:1,colspan:1})}}(e,t),$("div#table").html("");let a=$("<table class='table table-striped'>"),n=$("<tbody>").appendTo(a);for(let t=0;t<e.length;t++){let a=$("<tr>");for(let n=0;n<e[t].length;n++){let l=$("<td tabindex='1'>").attr("colspan",e[t][n].colspan).attr("rowspan",e[t][n].rowspan);e[t][n].refer=l.get(0),$("<input>").val(e[t][n].name).change((function(){e[t][n].name=$(this).val()})).appendTo(l),l.appendTo(a);let o=$("<div class='icons'>").appendTo(l);$("<span>x</span>").appendTo(o);if($('<a href="#!">').html('<i class="fa fa-plus">').click((function(){e[t].splice(n+1,0,{name:"",rowspan:e[t][n],colspan:1}),f(e)})).appendTo(o),$('<a href="#!">').html('<i class="fa fa-close tool-close">').click((function(){console.log(e);for(let t=0;t<e.length;t++)for(let a=0;a<e[t].length;a++)e.length>1&&e[t].length>1&&e[t][a].refer==$(this).closest("td").get(0)&&(1==e[t][a].colspan?e[t].splice(a,1):e[t][a].colspan--,f(e,!0))})).appendTo(o),n!=e[t].length-1){$("<a>").html('<i class="fa fa-arrow-right"></i>').click((function(){for(let a=0;a<e.length;a++)e[a][n+1]&&t-a==Number.parseInt(e[a][n+1].rowspan)-1&&e[a][n+1].rowspan--;let a=e[t][n+1];e[t][n].colspan=Number.parseInt(e[t][n].colspan)+Number.parseInt(a.colspan);for(let a=t;a<=t+Number.parseInt(e[t][n].rowspan)-1;a++)a==t?e[a].splice(n+1,1):e[a].pop();f(e)})).appendTo(o)}if(e[t][n].colspan>1){$("<a>").html('<i class="fa fa-arrow-left"></i>').click((function(){e[t][n].colspan--;for(let a=t;a<t+Number.parseInt(e[t][n].rowspan);a++)e[a].push({name:"",rowspan:1,colspan:1});f(e)})).appendTo(o)}if(Number.parseInt(e[t][n].rowspan)>1){$("<a>").html('<i class="fa fa-arrow-up"></i>').click((function(){e[t][n].rowspan--;for(let a=0;a<Number.parseInt(e[t][n].colspan);a++)e[t+Number.parseInt(e[t][n].rowspan)].push({name:"",rowspan:1,colspan:1});f(e)})).appendTo(o)}if(t+Number.parseInt(e[t][n].rowspan)-1!=e.length-1){$("<a>").html('<i class="fa fa-arrow-down"></i>').click((function(){for(let a=0;a<Number.parseInt(e[t][n].colspan);a++){let a=e[t+Number.parseInt(e[t][n].rowspan)];a&&a.pop()}e[t][n].rowspan++,f(e)})).appendTo(o)}}a.appendTo(n)}a.appendTo("div#table");$('<a href="#!" class="btn btn-default">').html('Добавить строку <i class="fa fa-plus"></i>').click((function(){e.push([]),f(e)})).appendTo("div#table"),$('<a href="#!" class="btn btn-default">').html('Удалить строку <i class="fa fa-close"></i>').click((function(){e.pop(),f(e)})).appendTo("div#table")}if(n.click((function(){let e=$("#table-view table tbody tr").last().clone();e.appendTo("#table-view table tbody"),e.find("span.numberation").text(Number.parseInt(e.find("span.numberation").text())+1),e.find("input").val(""),e.find("input, select").each((function(e,t){let a=t.name.split("[").join(",").split("][").join(",").split("]").join(",").split(",");(a=a.filter(e=>""!=e)).length>0&&(t.name=a[0]+"["+(Number.parseInt(a[1])+1)+"]["+a[2]+"]")}))})),l.click((function(){let e=$("#table-view table tbody tr");e.length>1&&e.last().remove()})),a.click((function(){(function(){var e=!1;$("#table input").each((function(t,a){""==$(a).val()?($(a).css({border:"1px solid #E64320"}),e=!0):$(a).css({border:"1px solid #ccc"})})),$("#types input").each((function(t,a){$(a).closest(".form-group").hasClass("active")&&""==$(a).val()?($(a).css({border:"1px solid #E64320"}),e=!0):$(a).css({border:"1px solid #ccc"})}));let t=0;if(p.length>0){for(let e=0;e<p[0].length;e++)t+=p[0][e].colspan;t!=r.length&&(e=!0,alert("Количества стобцов у шапки таблицы и тело таблицы должны быть равны"))}return e})()||function(e,t,a,n,l=null){e.length>0&&t.length>0&&a&&n&&$.ajax({method:"POST",data:{matrix:e,types:t,count:a,name:n,id:l},url:"http://eko.md.uz/api/default/index"}).done((function(e){e.status}))}(p,r,i,c,o)})),e.click((function(){let e=$("input#n").val(),a=$("input#m").val();if(i=$("input#k").val(),c=$("input#table-name").val(),e&&a&&i&&e>0&&a>0&&i>0&&c&&""!=c){t.show(),p=[],r=[];for(let t=0;t<a;t++){p[t]=[];for(let a=0;a<e;a++)p[t][a]={name:"",colspan:1,rowspan:1,x:t,y:a}}for(let t=0;t<e;t++)r[t]={type:1,variants:[],name:"",formula:"",table:""};f(p),u(r)}!e||e<=0?$("#n-error").text("Укажите значение N"):$("#n-error").text(""),!a||a<=0?$("#m-error").text("Укажите значение M"):$("#m-error").text(""),!i||i<=0?$("#k-error").text("Укажите значение K"):$("#k-error").text(""),!c||c<=0?$("#table-name-error").text("Укажите название таблицы"):$("#table-name-error").text("")})),$("#update-table-form").length>0){let e=$("#update-table-matrix-json").val(),t=$("#update-table-types-json").val(),a=$("#update-table-count").val(),n=$("#update-table-name").val();p=JSON.parse(e),r=JSON.parse(t),i=a,c=n,f(p),u(r)}}))}]);